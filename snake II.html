<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Snake</title>
</head>
<body style='background-color:white'>
</body>
<script>
	var snakeGame, kaa;
	
	snakeGame = new SnakeGame(450, 300, 25, 150);
	kaa = new Snake([[2,5], [1,5], [0,5]], 'right');
	snakeGame.init(kaa);
	
	document.addEventListener('keydown', function(e)
	{
		let direction = kaa.direction;
		switch(e.key)
		{
			case 'ArrowRight':
				direction = direction === 'left' ? 'left' : 'right';
				break;
			case 'ArrowDown':
				direction = direction === 'up' ? 'up' : 'down';
				break;
			case 'ArrowUp':
				direction = direction === 'down' ? 'down' : 'up';
				break;
			case 'ArrowLeft':
				direction = direction === 'right' ? 'right' : 'left';
				break;
		}
		kaa.direction = direction;
	});
	
	function SnakeGame(canvasWidth, canvasHeight, blockSize, delay)
	{
		this.canvas = document.createElement('canvas');
		this.ctx = this.canvas.getContext('2d');
		this.blockSize = blockSize;
		this.canvas.width = canvasWidth;
		this.canvas.height = canvasHeight;
		this.canvas.style.border = '1px solid';
		this.canvas.style.margin = '0 auto';
		this.canvas.style.display = 'block';
		this.canvas.style.marginTop = '50vh';
		this.canvas.style.transform =  'translateY(-50%)';
		document.body.appendChild(this.canvas);
		this.delay = delay;
		var instance = this,
				timeout;
		
		this.init = function(snake)
		{
			this.snake = snake;
			snake.draw(this.ctx, this.blockSize);
			clearTimeout(timeout);
			refreshCanvas();
		};
		
		var refreshCanvas = function()
		{
			instance.snake.advance();
			instance.ctx.clearRect(0, 0, instance.canvas.width, instance.canvas.height);
			instance.snake.draw(instance.ctx, instance.blockSize);
			timeout = setTimeout(refreshCanvas, instance.delay);
		}
	}
	
	function Snake(position, direction)
	{
		this.position = position;
		this.direction = direction;
		this.draw = function(ctx, blockSize)
		{
			ctx.save();
			ctx.fillStyle = '#BADA55';
			for(let i = 0; i < this.position.length; i++)
				ctx.fillRect((this.position[i][0] * blockSize) - 1, (this.position[i][1] * blockSize) - 1, blockSize, blockSize);
			ctx.restore();
		};
		
		this.advance = function()
		{
			let x = this.position[0][0],
					y = this.position[0][1];
				switch(this.direction)
				{
					case "right":		
						x++;
						break;
					case "left":		
						x--;
						break;
					case "up":		
						y--;
						break;
					case "down":		
						y++;
						break;
					default:
						x++;
				}
			this.position.unshift([x, y]);
			this.position.pop();
		};
	}
</script>
</html>